{"id":802,"date":"2020-12-30T13:43:22","date_gmt":"2020-12-30T18:43:22","guid":{"rendered":"https:\/\/learnctd.wpengine.com\/?page_id=802"},"modified":"2021-12-06T09:51:16","modified_gmt":"2021-12-06T14:51:16","slug":"rails-comprehensive-assignment","status":"publish","type":"page","link":"https:\/\/learn.codethedream.org\/rails-comprehensive-assignment\/","title":{"rendered":"Rails Comprehensive Assignment"},"content":{"rendered":"\n<p>In this assignment, we put all of the skills together.  This assignment is intended to check whether you have learned the basic concepts of Rails development.&nbsp; For each part, there are examples in the blog application or in subsequent lessons, so you should be able to copy\/paste into your new code, with changes to make everything work.<\/p>\n\n\n\n<h2>Git Setup<\/h2>\n\n\n\n<p>We are going to continue to use the git repository from the last lesson, but we will also use a new git branch for this.&nbsp; For your current branch, make sure you have committed all your changes and pushed them to github.&nbsp; Make sure that the rspec branch is active, so that you have all the changes from that branch.&nbsp; Then do the following commands:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>git checkout -b full-assignment\ngit push -u origin full-assignment\n<\/code><\/pre>\n\n\n\n<h2>Specifications for the Assignment<\/h2>\n\n\n\n<ol><li>Within the customer-order application, create a new model called Order.\u00a0 This will have attributes called product_name (string), product_count (integer), and customer_id (integer).  \u00a0Each order will belong to a customer.  The customer_id field is generated with customer:references &#8212; see the generate model command in the following paragraph..<\/li><li>Create a new set of routes to manage CRUD operations for the orders resource.\u00a0 Do not nest these routes under customer.<\/li><li>Create an OrdersController.\u00a0 Add methods for index, show, new, edit, create, update, and destroy.\u00a0 These will be similar to the methods in other controllers you have seen.<\/li><li>Create views (html.erb files) for orders: edit, index, new, and show.\u00a0 These should be similar to the views for customer.\u00a0 edit and new should share a partial form.<\/li><li>The new\/edit form for the order should have a drop down list of customers to choose from when creating or updating an order, as well as fields for product_name and product_count.<\/li><li>The controller should include error handling.<\/li><li>Change the show view for the customer, so that if that customer has orders, a list of them are shown in a table at the bottom, with show\/update\/delete links.\u00a0 You will need to add the appropriate has_many line to the customer model.<\/li><li>Add validations to the order model so that validates that a product_name, product_count, and customer are present, and so that it checks that the customer_id actually corresponds to a real customer record.<\/li><li>Create model tests for the order model, to make sure that each of the validations works correctly.<\/li><li>Create request tests for the order controller, to make sure that each of the methods works correctly.<\/li><\/ol>\n\n\n\n<p>Use the following commands to get started:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>bin\/rails generate model Order product_name:string product_count:integer customer:references\nbin\/rails db:migrate\nbin\/rails generate controller orders<\/code><\/pre>\n\n\n\n<p>Before you run rspec, you have to migrate the test database:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>bin\/rails db:migrate db:test:prepare<\/code><\/pre>\n\n\n\n<h2>A Few New Ideas<\/h2>\n\n\n\n<p>In your Order model, to validate that the customer_id in the order actually points to an existing customer record, you will need the line:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>validates_associated :customer<\/code><\/pre>\n\n\n\n<p>To create the dropdown list for choosing the customer for the order, you can use this line:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>&lt;%= f.collection_select :customer_id, Customer.all, :id, :full_name, include_blank: true %&gt;<\/code><\/pre>\n\n\n\n<p>In the rspec test for the order model, you can set up the subject with this line:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>subject { Order.new( product_name: \"gears\", product_count: 7, customer: FactoryBot.create(:customer))}<\/code><\/pre>\n\n\n\n<p>In the rspec test for the order controller, you will need a factory that generates an order.  But as each order belongs to a customer, the factory has to create the customer object too.  To do this, FactoryBot uses the association method:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>FactoryBot.define do\n  factory :order do\n    product_name { Faker::Lorem.word }\n    product_count { Faker::Number.number(digits: 3).to_i }\n    association :customer\n  end\nend<\/code><\/pre>\n\n\n\n<p>The key point here is the use of association. Now, we can do order = FactoryBot.create(:order) and it will create an order for us and store it in the database, creating the necessary customer object as well. Unfortunately, that doesn&#8217;t quite solve all our problems. For the post method, we need to get the attributes for an order object. If we do attributes = FactoryBot.attributes_for(:order) it will not store anything in the database. It will also not create any attributes corresponding to the customer. So we have to create the customer object explicitly, and add its id to the list of attributes, as follows:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>customer = FactoryBot.create(:customer)\norder_attributes = FactoryBot.attributes_for(:order, customer_id: customer.id)<\/code><\/pre>\n\n\n\n<p>The resulting attributes could be passed in the parameters when testing the post method to create an order entry.<\/p>\n\n\n\n<p>Good rspec testing validates that the correct page is displayed.  If a redirect is expected to occur, one should check that the redirect goes to the right page, for example:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>expect (response).to redirect_to orders_path<\/code><\/pre>\n\n\n\n<p>If a redirect does not occur, you should check that the right page template is displayed:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>expect (response).to render_template(:show)<\/code><\/pre>\n\n\n\n<p>To get the render_template matcher to work, you will need to add this gem to the test section of your gemfile, and run bundle install:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>gem 'rails-controller-testing'<\/code><\/pre>\n\n\n\n<p>Here are a couple example tests from the orders request test that may help to explain rspec request testing:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>  describe \"put order_path with valid data\" do\n    it \"updates an entry and redirects to the show path for the customer\" do\n      order = FactoryBot.create(:order)\n      put \"\/orders\/#{order.id}\", params: {order: {product_count: 50}}\n      order.reload\n      expect(order.product_count).to eq(50)\n      expect(response).to redirect_to(\"\/orders\/#{order.id}\")\n    end\n  end\n  describe \"put order_path with invalid data\" do\n    it \"does not update the customer record or redirect\" do\n      order = FactoryBot.create(:order)\n      put \"\/orders\/#{order.id}\", params: {order: {customer_id: 5001}}\n      order.reload\n      expect(order.customer_id).not_to eq(5001)\n      expect(response).to render_template(:edit)\n    end\n  end\n<\/code><\/pre>\n","protected":false},"excerpt":{"rendered":"<p>In this assignment, we put all of the skills together. This assignment is intended to check whether you have learned the basic concepts of Rails development.&nbsp; For each part, there are examples in the blog application or in subsequent lessons, so you should be able to copy\/paste into your new code, with changes to make<\/p>\n","protected":false},"author":5,"featured_media":0,"parent":0,"menu_order":0,"comment_status":"closed","ping_status":"closed","template":"","meta":{"_genesis_hide_title":false,"_genesis_hide_breadcrumbs":false,"_genesis_hide_singular_image":false,"_genesis_hide_footer_widgets":false,"_genesis_custom_body_class":"","_genesis_custom_post_class":"","_genesis_layout":"","_vp_format_video_url":"","_vp_image_focal_point":[]},"featured_image_src":null,"featured_image_src_square":null,"_links":{"self":[{"href":"https:\/\/learn.codethedream.org\/wp-json\/wp\/v2\/pages\/802"}],"collection":[{"href":"https:\/\/learn.codethedream.org\/wp-json\/wp\/v2\/pages"}],"about":[{"href":"https:\/\/learn.codethedream.org\/wp-json\/wp\/v2\/types\/page"}],"author":[{"embeddable":true,"href":"https:\/\/learn.codethedream.org\/wp-json\/wp\/v2\/users\/5"}],"replies":[{"embeddable":true,"href":"https:\/\/learn.codethedream.org\/wp-json\/wp\/v2\/comments?post=802"}],"version-history":[{"count":0,"href":"https:\/\/learn.codethedream.org\/wp-json\/wp\/v2\/pages\/802\/revisions"}],"wp:attachment":[{"href":"https:\/\/learn.codethedream.org\/wp-json\/wp\/v2\/media?parent=802"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}